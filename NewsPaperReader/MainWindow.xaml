<Window x:Class="NewsPaperReader.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:NewsPaperReader"
        xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        mc:Ignorable="d"
        Title="在线报纸阅读器" Height="800" Width="1200"
        WindowStartupLocation="CenterScreen"
        Loaded="MainWindow_Loaded">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="300"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        
        <!-- 工具栏 -->
        <materialDesign:Card Grid.Row="0" Grid.Column="0" Margin="10,10,0,10">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Left">
                <Button Command="{Binding AddNewspaperCommand}" Margin="2" Style="{StaticResource MaterialDesignRaisedButton}">
                    <materialDesign:PackIcon Kind="Plus"/>
                </Button>
                <Button Command="{Binding RefreshCommand}" Margin="2" Style="{StaticResource MaterialDesignOutlinedButton}">
                    <materialDesign:PackIcon Kind="Refresh"/>
                </Button>
                <Separator Width="10"/>
                <Button Command="{Binding SettingsCommand}" Margin="2" Style="{StaticResource MaterialDesignOutlinedButton}">
                    <materialDesign:PackIcon Kind="Cog"/>
                </Button>
                <Button Command="{Binding AboutCommand}" Margin="2" Style="{StaticResource MaterialDesignOutlinedButton}">
                    <materialDesign:PackIcon Kind="Information"/>
                </Button>
            </StackPanel>
        </materialDesign:Card>
        
        <!-- 搜索框 -->
        <materialDesign:Card Grid.Row="0" Grid.Column="1" Margin="10" HorizontalAlignment="Stretch">
            <TextBox materialDesign:HintAssist.Hint="搜索报纸..." Width="300" HorizontalAlignment="Left" Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
        </materialDesign:Card>
        
        <!-- 左侧边栏 -->
        <materialDesign:Card Grid.Row="1" Grid.Column="0" Margin="10,0,0,10" VerticalAlignment="Stretch">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <!-- 报纸列表标题 -->
                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="10,10,10,5">
                    <TextBlock Text="报纸列表" FontWeight="Bold" FontSize="14"/>
                </StackPanel>
                
                <!-- 报纸列表 -->
                <ListBox Grid.Row="1" x:Name="NewspaperListBox" ItemsSource="{Binding Newspapers}" 
                     SelectedItem="{Binding SelectedNewspaper}"
                     BorderThickness="0"
                     ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                     VerticalAlignment="Stretch">
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="Padding" Value="2"/>
                            <Setter Property="Cursor" Value="Hand"/>
                            <Setter Property="Margin" Value="1"/>
                            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                        </Style>
                    </ListBox.ItemContainerStyle>
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Grid HorizontalAlignment="Stretch" VerticalAlignment="Center">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <!-- 报纸信息 -->
                                <StackPanel Grid.Column="0" HorizontalAlignment="Stretch" VerticalAlignment="Center" Margin="0">
                                    <Image x:Name="TitleImage" Source="{Binding TitleImagePath}" Width="100" Height="40" Stretch="Uniform" Margin="0" Visibility="Collapsed"/>
                                    <TextBlock x:Name="NewspaperName" Text="{Binding Name}" VerticalAlignment="Center" TextAlignment="Left" Margin="0"/>
                                </StackPanel>
                                
                                <!-- 操作按钮 -->
                                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center" Visibility="Collapsed" x:Name="ActionButtons">
                                    <Button ToolTip="编辑" Click="EditNewspaperButton_Click" Tag="{Binding}" Margin="2">
                                        <materialDesign:PackIcon Kind="Pencil" Width="16" Height="16"/>
                                    </Button>
                                    <Button ToolTip="删除" Click="DeleteNewspaperButton_Click" Tag="{Binding}" Margin="2">
                                        <materialDesign:PackIcon Kind="Delete" Width="16" Height="16"/>
                                    </Button>
                                </StackPanel>
                            </Grid>
                            <DataTemplate.Triggers>
                                <!-- 鼠标悬停时显示操作按钮 -->
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="ActionButtons" Property="Visibility" Value="Visible"/>
                                </Trigger>
                                
                                <!-- 文本列表模式：只显示名称 -->
                                <DataTrigger Binding="{Binding DataContext.NewspaperListMode, RelativeSource={RelativeSource AncestorType={x:Type ListBox}}}" Value="TextList">
                                    <Setter TargetName="TitleImage" Property="Visibility" Value="Collapsed"/>
                                    <Setter TargetName="NewspaperName" Property="Visibility" Value="Visible"/>
                                </DataTrigger>
                                <!-- 图片列表模式：显示图片，如果没有图片则显示名称 -->
                                <DataTrigger Binding="{Binding DataContext.NewspaperListMode, RelativeSource={RelativeSource AncestorType={x:Type ListBox}}}" Value="ImageList">
                                    <Setter TargetName="TitleImage" Property="Visibility" Value="Visible"/>
                                    <Setter TargetName="NewspaperName" Property="Visibility" Value="Collapsed"/>
                                </DataTrigger>
                                <!-- 图片列表模式下，没有图片时显示名称 -->
                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition Binding="{Binding DataContext.NewspaperListMode, RelativeSource={RelativeSource AncestorType={x:Type ListBox}}}" Value="ImageList"/>
                                        <Condition Binding="{Binding TitleImagePath}" Value=""/>
                                    </MultiDataTrigger.Conditions>
                                    <Setter TargetName="TitleImage" Property="Visibility" Value="Collapsed"/>
                                    <Setter TargetName="NewspaperName" Property="Visibility" Value="Visible"/>
                                </MultiDataTrigger>
                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition Binding="{Binding DataContext.NewspaperListMode, RelativeSource={RelativeSource AncestorType={x:Type ListBox}}}" Value="ImageList"/>
                                        <Condition Binding="{Binding TitleImagePath}" Value="{x:Null}"/>
                                    </MultiDataTrigger.Conditions>
                                    <Setter TargetName="TitleImage" Property="Visibility" Value="Collapsed"/>
                                    <Setter TargetName="NewspaperName" Property="Visibility" Value="Visible"/>
                                </MultiDataTrigger>
                                <!-- 图片平铺模式：显示图片，如果没有图片则显示名称 -->
                                <DataTrigger Binding="{Binding DataContext.NewspaperListMode, RelativeSource={RelativeSource AncestorType={x:Type ListBox}}}" Value="ImageTile">
                                    <Setter TargetName="TitleImage" Property="Visibility" Value="Visible"/>
                                    <Setter TargetName="NewspaperName" Property="Visibility" Value="Collapsed"/>
                                </DataTrigger>
                                <!-- 图片平铺模式下，没有图片时显示名称 -->
                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition Binding="{Binding DataContext.NewspaperListMode, RelativeSource={RelativeSource AncestorType={x:Type ListBox}}}" Value="ImageTile"/>
                                        <Condition Binding="{Binding TitleImagePath}" Value=""/>
                                    </MultiDataTrigger.Conditions>
                                    <Setter TargetName="TitleImage" Property="Visibility" Value="Collapsed"/>
                                    <Setter TargetName="NewspaperName" Property="Visibility" Value="Visible"/>
                                </MultiDataTrigger>
                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition Binding="{Binding DataContext.NewspaperListMode, RelativeSource={RelativeSource AncestorType={x:Type ListBox}}}" Value="ImageTile"/>
                                        <Condition Binding="{Binding TitleImagePath}" Value="{x:Null}"/>
                                    </MultiDataTrigger.Conditions>
                                    <Setter TargetName="TitleImage" Property="Visibility" Value="Collapsed"/>
                                    <Setter TargetName="NewspaperName" Property="Visibility" Value="Visible"/>
                                </MultiDataTrigger>
                            </DataTemplate.Triggers>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
                
                <!-- 分割条 -->
                <Separator Grid.Row="2" Height="2" Margin="10"/>
                
                <!-- 版面列表标题 -->
                <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="10,5,10,5">
                    <TextBlock Text="版面列表" FontWeight="Bold" FontSize="14"/>
                </StackPanel>
                
                <!-- 版面列表 -->
                <ListBox Grid.Row="3" ItemsSource="{Binding Editions}" 
                         SelectedItem="{Binding SelectedEdition}"
                         DisplayMemberPath="Title"
                         BorderThickness="0"
                         VerticalAlignment="Stretch">
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="Padding" Value="5"/>
                            <Setter Property="Cursor" Value="Hand"/>
                        </Style>
                    </ListBox.ItemContainerStyle>
                </ListBox>
            </Grid>
        </materialDesign:Card>
        
        <!-- 主内容区域 -->
        <materialDesign:Card Grid.Row="1" Grid.Column="1" Margin="10" VerticalAlignment="Stretch">
            <Grid x:Name="ContentContainer">
                <!-- WebView2 -->
                <wv2:WebView2 x:Name="WebView2PdfViewer" Source="about:blank"/>
            </Grid>
        </materialDesign:Card>
    </Grid>
</Window>
