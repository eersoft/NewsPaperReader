<Window x:Class="NewsPaperReader.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:NewsPaperReader"
        xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
        mc:Ignorable="d"
        Title="在线报纸阅读器" Height="800" Width="1200"
        WindowStartupLocation="CenterScreen"
        Loaded="MainWindow_Loaded">

    <Window.Resources>
        <!-- 图标资源 -->
        <BitmapImage x:Key="AddIcon" UriSource="pack://application:,,,/NewsPaperReader;component/3rd_res/png/添加.png" />
        <BitmapImage x:Key="RefreshIcon" UriSource="pack://application:,,,/NewsPaperReader;component/3rd_res/png/刷新.png" />
        <BitmapImage x:Key="SettingsIcon" UriSource="pack://application:,,,/NewsPaperReader;component/3rd_res/png/设置.png" />
        <BitmapImage x:Key="AboutIcon" UriSource="pack://application:,,,/NewsPaperReader;component/3rd_res/png/关于.png" />
        
        <!-- 图标按钮样式 -->
        <Style x:Key="IconButton" TargetType="Button">
            <Setter Property="Width" Value="36" />
            <Setter Property="Height" Value="36" />
            <Setter Property="Margin" Value="2" />
            <Setter Property="ToolTip" Value="{Binding Content}" />
            <Setter Property="ContentTemplate">
                <Setter.Value>
                    <DataTemplate>
                        <Image Source="{Binding}" Width="24" Height="24" />
                    </DataTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        
        <!-- 左侧边栏 -->
        <Border x:Name="LeftSidebar" Grid.Row="0" Grid.Column="0" BorderBrush="LightGray" BorderThickness="0,0,1,0" MouseLeave="LeftSidebar_MouseLeave" Width="400" Background="White">
            <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="5"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <!-- 工具栏 -->
                    <ToolBarTray Grid.Row="0" IsLocked="True" Background="#F0F0F0">
                        <ToolBar>
                            <Button ToolTip="添加报纸" Command="{Binding AddNewspaperCommand}" Width="36" Height="36" Margin="2">
                                <Image Source="pack://siteoforigin:,,,/3rd_res/png/添加.png" Width="24" Height="24" />
                            </Button>
                            <Button ToolTip="刷新" Command="{Binding RefreshCommand}" Width="36" Height="36" Margin="2">
                                <Image Source="pack://siteoforigin:,,,/3rd_res/png/刷新.png" Width="24" Height="24" />
                            </Button>
                            <Separator/>
                            <Button ToolTip="设置" Command="{Binding SettingsCommand}" Width="36" Height="36" Margin="2">
                                <Image Source="pack://siteoforigin:,,,/3rd_res/png/设置.png" Width="24" Height="24" />
                            </Button>
                            <Button ToolTip="关于" Command="{Binding AboutCommand}" Width="36" Height="36" Margin="2">
                                <Image Source="pack://siteoforigin:,,,/3rd_res/png/关于.png" Width="24" Height="24" />
                            </Button>
                        </ToolBar>
                    </ToolBarTray>
                    
                    <!-- 报纸列表 -->
                    <Border Grid.Row="1" BorderBrush="LightGray" BorderThickness="0,1,0,0">
                        <DockPanel>
                            <TextBlock Text="报纸列表" FontWeight="Bold" DockPanel.Dock="Top" Style="{StaticResource DefaultTextBlock}"/>
                            <ListBox x:Name="NewspaperListBox" ItemsSource="{Binding Newspapers}" 
                                 SelectedItem="{Binding SelectedNewspaper}"
                                 BorderThickness="0"
                                 ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                            <ListBox.ItemContainerStyle>
                                <Style TargetType="ListBoxItem">
                                    <Setter Property="Padding" Value="2"/>
                                    <Setter Property="Cursor" Value="Hand"/>
                                    <Setter Property="Margin" Value="1"/>
                                </Style>
                            </ListBox.ItemContainerStyle>
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel HorizontalAlignment="Stretch" VerticalAlignment="Center" Margin="0">
                                        <Image x:Name="TitleImage" Source="{Binding TitleImagePath}" Width="100" Height="40" Stretch="Uniform" Margin="0" Visibility="Collapsed"/>
                                        <TextBlock x:Name="NewspaperName" Text="{Binding Name}" VerticalAlignment="Center" TextAlignment="Left" Margin="0"/>
                                    </StackPanel>
                                    <DataTemplate.Triggers>
                                        <!-- 文本列表模式：只显示名称 -->
                                        <DataTrigger Binding="{Binding DataContext.NewspaperListMode, RelativeSource={RelativeSource AncestorType={x:Type ListBox}}}" Value="TextList">
                                            <Setter TargetName="TitleImage" Property="Visibility" Value="Collapsed"/>
                                            <Setter TargetName="NewspaperName" Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                        <!-- 图片列表模式：显示图片，如果没有图片则显示名称 -->
                                        <DataTrigger Binding="{Binding DataContext.NewspaperListMode, RelativeSource={RelativeSource AncestorType={x:Type ListBox}}}" Value="ImageList">
                                            <Setter TargetName="TitleImage" Property="Visibility" Value="Visible"/>
                                            <Setter TargetName="NewspaperName" Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                        <!-- 图片列表模式下，没有图片时显示名称 -->
                                        <MultiDataTrigger>
                                            <MultiDataTrigger.Conditions>
                                                <Condition Binding="{Binding DataContext.NewspaperListMode, RelativeSource={RelativeSource AncestorType={x:Type ListBox}}}" Value="ImageList"/>
                                                <Condition Binding="{Binding TitleImagePath}" Value=""/>
                                            </MultiDataTrigger.Conditions>
                                            <Setter TargetName="TitleImage" Property="Visibility" Value="Collapsed"/>
                                            <Setter TargetName="NewspaperName" Property="Visibility" Value="Visible"/>
                                        </MultiDataTrigger>
                                        <MultiDataTrigger>
                                            <MultiDataTrigger.Conditions>
                                                <Condition Binding="{Binding DataContext.NewspaperListMode, RelativeSource={RelativeSource AncestorType={x:Type ListBox}}}" Value="ImageList"/>
                                                <Condition Binding="{Binding TitleImagePath}" Value="{x:Null}"/>
                                            </MultiDataTrigger.Conditions>
                                            <Setter TargetName="TitleImage" Property="Visibility" Value="Collapsed"/>
                                            <Setter TargetName="NewspaperName" Property="Visibility" Value="Visible"/>
                                        </MultiDataTrigger>
                                        <!-- 图片平铺模式：显示图片，如果没有图片则显示名称 -->
                                        <DataTrigger Binding="{Binding DataContext.NewspaperListMode, RelativeSource={RelativeSource AncestorType={x:Type ListBox}}}" Value="ImageTile">
                                            <Setter TargetName="TitleImage" Property="Visibility" Value="Visible"/>
                                            <Setter TargetName="NewspaperName" Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                        <!-- 图片平铺模式下，没有图片时显示名称 -->
                                        <MultiDataTrigger>
                                            <MultiDataTrigger.Conditions>
                                                <Condition Binding="{Binding DataContext.NewspaperListMode, RelativeSource={RelativeSource AncestorType={x:Type ListBox}}}" Value="ImageTile"/>
                                                <Condition Binding="{Binding TitleImagePath}" Value=""/>
                                            </MultiDataTrigger.Conditions>
                                            <Setter TargetName="TitleImage" Property="Visibility" Value="Collapsed"/>
                                            <Setter TargetName="NewspaperName" Property="Visibility" Value="Visible"/>
                                        </MultiDataTrigger>
                                        <MultiDataTrigger>
                                            <MultiDataTrigger.Conditions>
                                                <Condition Binding="{Binding DataContext.NewspaperListMode, RelativeSource={RelativeSource AncestorType={x:Type ListBox}}}" Value="ImageTile"/>
                                                <Condition Binding="{Binding TitleImagePath}" Value="{x:Null}"/>
                                            </MultiDataTrigger.Conditions>
                                            <Setter TargetName="TitleImage" Property="Visibility" Value="Collapsed"/>
                                            <Setter TargetName="NewspaperName" Property="Visibility" Value="Visible"/>
                                        </MultiDataTrigger>
                                    </DataTemplate.Triggers>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                        </DockPanel>
                    </Border>
                    
                    <!-- 分割条 -->
                    <GridSplitter Grid.Row="2" Height="5" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Background="LightGray"/>
                    
                    <!-- 版面列表 -->
                    <Border Grid.Row="3" BorderBrush="LightGray" BorderThickness="0,0,0,0">
                        <DockPanel>
                            <TextBlock Text="版面列表" FontWeight="Bold" DockPanel.Dock="Top" Style="{StaticResource DefaultTextBlock}"/>
                            <ListBox ItemsSource="{Binding Editions}" 
                                     SelectedItem="{Binding SelectedEdition}"
                                     DisplayMemberPath="Title"
                                     BorderThickness="0" Height="{Binding ActualHeight, RelativeSource={RelativeSource AncestorType={x:Type Border}}}">
                                <ListBox.ItemContainerStyle>
                                    <Style TargetType="ListBoxItem">
                                        <Setter Property="Padding" Value="5"/>
                                        <Setter Property="Cursor" Value="Hand"/>
                                    </Style>
                                </ListBox.ItemContainerStyle>
                            </ListBox>
                        </DockPanel>
                    </Border>
                </Grid>
        </Border>
        
        <!-- 主内容区域 -->
        <Border Grid.Row="0" Grid.Column="1" BorderBrush="LightGray" BorderThickness="0,0,0,0">
            <Grid x:Name="ContentContainer">
                <!-- WebView2 -->
                <wv2:WebView2 x:Name="WebView2PdfViewer" Source="about:blank"/>
            </Grid>
        </Border>
        

        
        <!-- 自动隐藏触发区域 -->
        <Border Width="5" Height="{Binding ActualHeight, RelativeSource={RelativeSource AncestorType={x:Type Window}}}" Background="Transparent" MouseEnter="AutoHideTrigger_MouseEnter" HorizontalAlignment="Left" Panel.ZIndex="100"/>
    </Grid>
</Window>
